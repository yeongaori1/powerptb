const { React, getModule } = require('powercord/webpack');

const windowStore = getModule([ 'getWindowFocused' ], false);
const DndPopoutProvider = getModule(m => typeof m.default === 'function' && m.default.toString().includes('DndProvider'), false);
const ConnectedPopoutWindow = DndPopoutProvider.default().props.children.type.render;

module.exports = React.memo((props) => {
  React.useEffect(() => {
    const guestWindow = windowStore.getWindow(props.windowKey);
    if (guestWindow) {
      document.querySelectorAll('style[data-powercord]').forEach(style => {
        guestWindow.document.head.innerHTML += style.outerHTML;
      });
    }
  }, []);

  if (!props.withTitleBar) {
    // Enforce it
    props.withTitleBar = false;
  }

  return <ConnectedPopoutWindow {...props} />;
});
